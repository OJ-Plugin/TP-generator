<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" />
    <title>TP Gnereator</title>
    <link rel="shortcut icon" type="image/x-icon" href="./statics/images/favicon.svg" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <link rel="stylesheet" type="text/css" href="./statics/css/materialdesignicons.min.css" />
    <link rel="stylesheet" type="text/css" href="./statics/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="./statics/css/animate.min.css" />
    <link rel="stylesheet" type="text/css" href="./statics/js/bootstrap-multitabs/multitabs.min.css" />
    <!--对话框插件css-->
    <link rel="stylesheet" type="text/css" href="js/jquery-confirm/jquery-confirm.min.css" />
    <link rel="stylesheet" type="text/css" href="./statics/css/style.min.css" />
  </head>

  <body class="lyear-index">
    <div class="lyear-layout-web">
      <div class="lyear-layout-container">
        <!--左侧导航-->
        <aside class="lyear-layout-sidebar">
          <!-- logo -->
          <div id="logo" class="sidebar-header">
            <a href="./index.html"><img src="./statics/images/page_bar_logo.png" alt="" /></a>
          </div>
          <div class="lyear-layout-sidebar-info lyear-scroll">
            <nav class="sidebar-main">
              <ul class="nav-drawer">
                <li class="nav-item active">
                  <a class="multitabs" href="./main.html" id="default-page">
                    <i class="mdi mdi-home-city-outline"></i>
                    <span>首页</span>
                  </a>
                </li>
                <li>
                  <a class="multitabs" href="./Q2TP.html">
                    <i class="mdi mdi-code-tags-check"></i>
                    题目生成测试点
                  </a>
                </li>
                <li>
                  <a class="multitabs" href="./E2TP.html">
                    <i class="mdi mdi-code-greater-than-or-equal"></i>
                    示例代码生成测试点
                  </a>
                </li>
                <li>
                  <a class="multitabs" href="./setting.html">
                    <i class="mdi mdi-cog"></i>
                    系统设置
                  </a>
                </li>
              </ul>
            </nav>

            <div class="sidebar-footer">
              <p class="copyright">
                <span>Copyright &copy; 2025. </span>
                <a target="_blank" href="https://github.com/OJ-Plugin">OJ-Plugin</a>
                <span> All rights reserved.</span>
              </p>
            </div>
          </div>
        </aside>
        <!--End 左侧导航-->

        <!--头部信息-->
        <header class="lyear-layout-header">
          <nav class="navbar">
            <div class="navbar-left">
              <!-- <div class="lyear-aside-toggler">
                <span class="lyear-toggler-bar"></span>
                <span class="lyear-toggler-bar"></span>
                <span class="lyear-toggler-bar"></span>
              </div> -->
            </div>
          </nav>
        </header>
        <!--End 头部信息-->

        <!--页面主要内容-->
        <main class="lyear-layout-content">
          <div id="iframe-content"></div>
        </main>
        <!--End 页面主要内容-->
      </div>
    </div>

    <script type="text/javascript" src="./statics/js/jquery.min.js"></script>
    <script type="text/javascript" src="./statics/js/popper.min.js"></script>
    <script type="text/javascript" src="./statics/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./statics/js/perfect-scrollbar.min.js"></script>
    <script type="text/javascript" src="./statics/js/bootstrap-multitabs/multitabs.min.js"></script>
    <script type="text/javascript" src="./statics/js/jquery.cookie.min.js"></script>
    <!--引入loading插件js-->
    <script type="text/javascript" src="js/lyear-loading.js"></script>
    <!--对话框插件js-->
    <script type="text/javascript" src="js/jquery-confirm/jquery-confirm.min.js"></script>
    <script type="text/javascript" src="js/main.min.js"></script>
    <script type="text/javascript" src="./statics/js/index.min.js"></script>
    <script type="text/javascript">
      // 检测移动设备
      function isMobileDevice() {
        return /Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      }

      // 页面加载时执行
      document.addEventListener("DOMContentLoaded", function () {
        if (isMobileDevice()) {
          // 找到所有row元素
          const rows = document.querySelectorAll(".lyear-index")[0];

          rows.innerHTML = `
          <div class='container' style='height: 100%;'>
            <div class='row' style='height: 100%;'>
              <div class='col-lg-12' style='margin: auto;'>
                <div class='card'>
                  <div class='card-body text-center'>
                    <h4>系统提示</h4>
                    <p>系统目前仅提供电脑端访问模式！</p>
                    <p>请使用电脑浏览器访问以获得完整功能体验。</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        }
      });
    </script>
    <script type="module">
      import { getVersion } from "https://unpkg.com/@tauri-apps/api/app?module";
      async function checkForUpdate() {
        try {
          // 获取当前本地版本
          const currentVersion = await getVersion();
          currentVersionText.textContent = currentVersion;

          // 获取 GitHub 上最新版本（Releases API）
          const response = await fetch("https://api.github.com/repos/OJ-Plugin/TP-generator/releases/latest", {
            headers: {
              Accept: "application/vnd.github.v3+json",
            },
          });

          if (!response.ok) throw new Error("GitHub API 请求失败");

          const releaseData = await response.json();
          const latestVersion = releaseData.tag_name.replace(/^v/, ""); // 如果是 v1.2.3 这种，加这行处理
          latestVersionText.textContent = latestVersion;

          // 对比版本（简单字符串比较，如果你用语义化版本，可以做更复杂的比较）
          if (latestVersion !== currentVersion) {
            console.log("发现新版本，准备更新...");
            update_app();
          } else {
            console.log("当前已经是最新版本");
          }
        } catch (err) {
          console.error("检查更新失败:", err);
          latestVersionText.textContent = "检查失败";
        }
      }

      function update_app() {
        // 你可以在这里写更新逻辑，比如打开下载链接、调用 Tauri 后端、提示用户更新等
        alert("检测到新版本，准备更新！");
        // 示例：跳转到 GitHub Releases 页面
        window.open("https://github.com/OJ-Plugin/TP-generator/releases/latest", "_blank");
      }

      // 启动检查
      checkForUpdate();
    </script>
    <!-- TODO: Wait to be resolved: Uncaught TypeError: Failed to resolve module specifier "@tauri-apps/api/app". Relative references must start with either "/", "./", or "../". -->
    <!-- <script type="module">
      import { getVersion } from "@tauri-apps/api/app";
      import { open } from "@tauri-apps/api/shell";
      import { appWindow } from "@tauri-apps/api/window";

      const GITHUB_API = "https://api.github.com/OJ-Plugin/TP-generator/repo/releases/latest";
      const GITEE_API = "https://gitee.com/api/v5/repos/OJ-Plugin/TP-generator/releases/latest";
      document.addEventListener("DOMContentLoaded", async function check_update() {
        var l = $("body").lyearloading({
          opacity: 0.2,
          spinnerSize: "lg",
        });
        // 获取本地版本号
        const currentVersion = await getVersion();

        // 用 Tauri 内置的 HTTP fetch （推荐解决跨域问题，也可以用 window.fetch）
        const { fetch } = await import("@tauri-apps/api/http");
        // 获取 GitHub最新release
        const resp = await fetch(GITEE_API, {
          method: "GET",
          // 可以加headers，如果必要比如 User-Agent，但一般无须
          responseType: 1, // JSON
        });

        const latest = resp.data;
        // GitHub release 版本号在 tag_name 字段
        const latestVersion = latest.tag_name.startsWith("v") ? latest.tag_name.slice(1) : latest.tag_name;

        console.log("当前版本：", currentVersion);
        console.log("最新版本：", latestVersion);

        if (compareVersion(latestVersion, currentVersion) > 0) {
          console.log("有新版本可用：" + latest.tag_name);
          // 这里可以弹窗或者为前端按钮提供下载等操作
          $.alert({
            title: "检查更新",
            content: "发现新版本(" + latestVersion + ")，更新后再愉快的使用吧！",
            icon: "mdi mdi-rocket",
            animation: "scale",
            closeAnimation: "scale",
            buttons: {
              github: {
                text: "GitHub更新",
                btnClass: "btn-blue",
                action: openLinkAndClose("https://github.com/OJ-Plugin/TP-generator/releases/latest"),
              },
              gitee: {
                text: "Gitee更新",
                btnClass: "btn-blue",
                action: openLinkAndClose("https://gitee.com/OJ-Plugin/TP-generator/releases"),
              },
            },
          });
        } else {
          console.log("已是最新版本");
          l.destroy();
        }
      });

      function compareVersion(v1, v2) {
        const s1 = v1.split(".").map(Number);
        const s2 = v2.split(".").map(Number);
        for (let i = 0; i < Math.max(s1.length, s2.length); i++) {
          const n1 = s1[i] || 0,
            n2 = s2[i] || 0;
          if (n1 > n2) return 1;
          if (n1 < n2) return -1;
        }
        return 0;
      }

      async function openLinkAndClose(url) {
        await open(url);
        await appWindow.close();
      }
    </script> -->
  </body>
</html>
